<header>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">
        System Monitor
      </a>
    </div>
  </nav>
</header>
<main class="container my-3">
  <div class="row">
    <ng-container *ngIf="info$ | async as info">
      <ng-container *ngIf="watch$ | async as data">
        <div class="col-12 col-md-4 p-2">
          <div class="card h-100 bg-dark bg-opacity-75 text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-content-center">
                <div>
                  <h6 class="text-uppercase text-white-50">Date</h6>
                  <h5 class="font-weight-bolder mb-0">{{(data.time.current || info.time.current) | date: 'longDate': data.time.timezone}}</h5>
                </div>
                <div class="bg-white p-1 rounded-circle text-center shadow-sm" style="width: 50px; height: 50px;">
                  <i class="text-dark fs-5 fa-solid fa-calendar-days text-secondary position-relative" style="top: 10px"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4 p-2">
          <div class="card h-100 bg-dark bg-opacity-75 text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-content-center">
                <div>
                  <h6 class="text-uppercase text-white-50">Time</h6>
                  <h5 class="font-weight-bolder mb-0">{{(data.time.current || info.time.current) | date: 'fullTime': data.time.timezone}}</h5>
                </div>
                <div class="bg-white p-1 rounded-circle text-center shadow-sm" style="width: 50px; height: 50px;">
                  <i class="text-dark fs-5 fa-solid fa-clock text-secondary position-relative" style="top: 10px"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4 p-2">
          <div class="card h-100 bg-dark bg-opacity-75 text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between align-content-center">
                <div>
                  <h6 class="text-uppercase text-white-50">Uptime</h6>
                  <ng-container *ngIf="getUptime(data.time.uptime || info.time.uptime) as uptime">
                    <h5 class="font-weight-bolder mb-0">{{uptime.days}} days {{uptime.hours | number: '2.0'}}:{{uptime.minutes | number: '2.0'}}:{{uptime.seconds | number: '2.0'}}</h5>
                  </ng-container>
                </div>
                <div class="bg-white p-1 rounded-circle text-center shadow-sm" style="width: 50px; height: 50px;">
                  <i class="text-dark fs-5 fa-solid fa-clock-rotate-left text-secondary position-relative" style="top: 10px"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 p-2">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">
                <i class="fa-solid fa-microchip"></i>
                CPU - {{info.cpu.manufacturer}} {{info.cpu.brand}} @ {{info.cpu.speed}} GHz
              </h4>
              <h6 class="card-subtitle mb-2 text-muted">
                Cores: {{info.cpu.physicalCores}} ({{info.cpu.cores}} threads)
              </h6>
              <div class="card-text">
                <div class="row m-0 p-0">
                  <ng-container *ngFor="let core of info.currentLoad.cpus; index as i">
                    <div class="col-md-6 px-2 py-1">
                      <div class="m-auto">{{data.currentLoad.cpus[i].load || core.load | number: '1.0-2'}}%</div>
                      <div class="progress">
                        <div class="progress-bar bg-{{getColor(data.currentLoad.cpus[i].load || core.load)}} progress-bar-animated" role="progressbar" [style.width.%]="data.currentLoad.cpus[i].load || core.load | number: '1.0-0'" [attr.aria-valuenow]="data.currentLoad.cpus[i].load || core.load | number: '1.0-0'" aria-valuemin="0" aria-valuemax="100"></div>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 p-2">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">
                <i class="fa-solid fa-memory"></i>
                RAM
              </h4>
              <div class="card-text">
                <div class="d-flex align-items-center px-2">
                  <div class="flex-grow-1 progress">
                    <div
                      class="progress-bar bg-{{getColor((data.mem.used || info.mem.used) / info.mem.total * 100)}} progress-bar-animated"
                      role="progressbar"
                      [style.width.%]="(data.mem.used || info.mem.used) / info.mem.total * 100 | number: '1.0-0'"
                      [attr.aria-valuenow]="(data.mem.used || info.mem.used) / info.mem.total * 100 | number: '1.0-0'"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    >
                      {{(data.mem.used || info.mem.used) / info.mem.total * 100 | number: '1.0-2'}}%
                    </div>
                  </div>
                  <div>
                    <h6 class="text-muted mb-0 ms-2">
                      {{(data.mem.used || info.mem.used)/1024/1024/1024 | number: '1.0-2'}} / {{info.mem.total/1024/1024/1024 | number: '1.0-2'}} GB
                    </h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-container *ngFor="let gpu of info.graphics.controllers; index as i">
          <div class="col-12 p-2">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">
                  <i class="fa-solid fa-computer"></i>
                  GPU - {{gpu.name}}
                </h4>
                <h6 class="card-subtitle text-muted">
                  Driver Version: {{gpu.driverVersion}}
                </h6>
                <div class="card-text">
                  <div class="d-flex justify-content-around py-4">
                    <div>
                      <h6 class="text-center text-muted text-uppercase mb-1">Fan</h6>
                      <h4 class="text-center fw-normal mb-0">
                        <i class="fa-solid fa-fan"></i>
                        {{data.graphics.controllers[i].fanSpeed || gpu.fanSpeed}} %
                      </h4>
                    </div>
                    <div>
                      <h6 class="text-center text-muted text-uppercase mb-1">Temperature</h6>
                      <h4 class="text-center fw-normal mb-0">
                        <i class="fa-solid fa-temperature-half"></i>
                        {{data.graphics.controllers[i].temperatureGpu || gpu.temperatureGpu}} °C
                      </h4>
                    </div>
                    <div>
                      <h6 class="text-center text-muted text-uppercase mb-1">Power</h6>
                      <h4 class="text-center fw-normal mb-0">
                        <i class="fa-solid fa-bolt-lightning"></i>
                        {{data.graphics.controllers[i].powerDraw || gpu.powerDraw}} / {{gpu.powerLimit}} W
                      </h4>
                    </div>
                  </div>

                  <div class="d-flex align-items-center px-2">
                    <div class="flex-grow-1 progress">
                      <div
                        class="progress-bar bg-{{getColor((gpu.memoryTotal - (data.graphics.controllers[i].memoryFree || gpu.memoryFree)) / gpu.memoryTotal * 100)}} progress-bar-animated"
                        role="progressbar"
                        [style.width.%]="(gpu.memoryTotal - (data.graphics.controllers[i].memoryFree || gpu.memoryFree)) / gpu.memoryTotal * 100 | number: '1.0-0'"
                        [attr.aria-valuenow]="(gpu.memoryTotal - (data.graphics.controllers[i].memoryFree || gpu.memoryFree)) / gpu.memoryTotal * 100 | number: '1.0-0'"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      >
                        {{(gpu.memoryTotal - (data.graphics.controllers[i].memoryFree || gpu.memoryFree)) / gpu.memoryTotal * 100 | number: '1.0-2'}}%
                      </div>
                    </div>
                    <div>
                      <h6 class="text-muted mb-0 ms-2">
                        {{(data.graphics.controllers[i].memoryUsed || gpu.memoryUsed)/1024 | number: '1.0-2'}} / {{gpu.memoryTotal/1024 | number: '1.0-2'}} GB
                      </h6>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
</main>
<footer class="mt-auto">
  <nav class="navbar bg-light">
    <div class="container">
      <span class="navbar-text text-nowrap">
        Márton Torner © {{year}} - All rights reserved.
      </span>
    </div>
  </nav>
</footer>
